<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Homework</title>
  <style>
    canvas { border: 1px solid #000; }
  </style>
</head>
<body>
  <canvas id="_Canvas" width="800" height="800"></canvas>
</body>
</html>

<script>

const canvas = document.getElementById('_Canvas');
const ctx = canvas.getContext('2d');

class Tank{

    static CELL_SIZE = 14 ;
    h = 0 ;
    row = Math.floor(Math.random()*39) ;  
    col = Math.floor(Math.random()*39) ; 
    red = Math.floor(Math.random()*256) ;
    green = Math.floor(Math.random()*256) ;
    blue = Math.floor(Math.random()*256) ;
    static drawBackground(){
        ctx.strokeStyle = "orange";
        for (let i=0;i<40+1;i++){
            ctx.moveTo(Tank.CELL_SIZE*i,0 );
            ctx.lineTo(Tank.CELL_SIZE*i,Tank.CELL_SIZE*40);
        } 
        for (let j=0;j<40+1;j++){
            ctx.moveTo(0,Tank.CELL_SIZE*j );
            ctx.lineTo(Tank.CELL_SIZE*40,Tank.CELL_SIZE*j);    
        }
        ctx.stroke();
    }
    drawCell(){
        ctx.fillStyle = `rgb(${this.red},${this.green},${this.blue})` ;
        ctx.fillRect( this.col*Tank.CELL_SIZE+1, this.row*Tank.CELL_SIZE+1, Tank.CELL_SIZE-2, Tank.CELL_SIZE-2 ) ;
    }
    cleanCell(){
        ctx.fillStyle = `rgb(255,255,255)` ;
        ctx.fillRect( this.col*Tank.CELL_SIZE+1, this.row*Tank.CELL_SIZE+1, Tank.CELL_SIZE-2, Tank.CELL_SIZE-2 ) ;
    }

    move(){
        this.cleanCell() ;
        let i = Math.floor(Math.random()*2) ;
        this.h = Math.floor(Math.random()*2) ;
        if (this.h==0){
            this.h=-1;
        }else{
            this.h=1 ;
        }
        if (i==0){
            this.row+=this.h ;
        }else{
            this.col+=this.h ;
        }
        if (this.row<0){
            this.row = 0  ;
        }
        if (this.row>19){
            this.row = 19 ;
        }
        if (this.col<0){
            this.col = 0 ;
        }
        if (this.col>39){
            this.col = 39 ;
        }
        this.drawCell() ;
        for (let i=0;i<tanks.length;i++){
            if ( tanks[i].row==myTank.row&&tanks[i].col==myTank.col ){
                tanks.splice(i,1) ;
                if (tanks.length==0){
                    console.log("ture:0") ; 
                }else{
                    console.log(`false:${tanks.length}`) ;
                }
                return ;
        }
    }
        // for (let i=0;i<tanks.length;i++){
        //     if ( tanks[i] !=this&&tanks[i].row==this.row&&tanks[i].col==this.col ){
        //         tanks.splice(i,1) ;
        //         return ;
        //     }
        // }
    }
}

class MyTank {
    row = 30 ;
    col = 20 ;
    constructor() {
        document.addEventListener( "keydown", this.keyDown.bind(this) ) ;
    }
    keyDown(event ) {
         this.cleanMyCell() ;
        if (event.code==`ArrowUp`){
            this.row-=1 ;
            if (this.row<20){
                this.row = 20  ;
            }
        }
        if (event.code==`ArrowDown`){
            this.row+=1 ;
            if (this.row>39){
                this.row = 39 ;
            }
        }
        if (event.code==`ArrowRight`){
            this.col+=1 ;
            if (this.col>39){
                this.col = 39 ;
            }
        }
        if (event.code==`ArrowLeft`){
            this.col-=1 ;
            if (this.col<0){
                this.col = 0 ;
            }
        }
        if (event.code==`Space`){
            let bullet = new Bullet(this.row,this.col) ;
        }
        this.drawMyCell() ;
        for (let i=0;i<tanks.length;i++){
        if ( tanks[i].row==this.row&&tanks[i].col==this.col ){
            tanks.splice(i,1) ;
            if (tanks.length==0){
                console.log('ture 0') ;
            }else{
                console.log(`false${tanks.length}`) ;
            }
            return ;
        }
    }
    }

    drawMyCell(){
        ctx.fillStyle = `rgb(0,0,0)` ;
        ctx.fillRect( this.col*Tank.CELL_SIZE+1, this.row*Tank.CELL_SIZE+1, Tank.CELL_SIZE-2, Tank.CELL_SIZE-2 ) ;
    }
    cleanMyCell(){
        ctx.fillStyle = `rgb(255,255,255)` ;
        ctx.fillRect( this.col*Tank.CELL_SIZE+1, this.row*Tank.CELL_SIZE+1, Tank.CELL_SIZE-2, Tank.CELL_SIZE-2 ) ;
    }
}

class Bullet{
    row = 0 ;
    col = 0 ;
    isRunning = true ;
    constructor(row,col) {
        this.row = row ;
        this.col = col ;
        this.move();
    }
    
    move(){
        if ( !this.isRunning ) {
            return ;
        }
        this.cleanBulletCell() ;
        this.row-=1 ;    
        if (this.row<0){
            this.isRunning=false ; 
            console.log(this.row) ;
        } 
        
        this.drawBulletCell() ;
        setTimeout( this.move.bind(this), 8 ) ;
        for (let i=0;i<tanks.length;i++){
            if ( tanks[i].row==this.row&&tanks[i].col==this.col ){
                tanks.splice(i,1) ;
                return ;
            }
        }
    }
    drawBulletCell(){
        ctx.fillStyle = `rgb(0,0,0)` ;
        ctx.fillRect( this.col*Tank.CELL_SIZE+1, this.row*Tank.CELL_SIZE+1, Tank.CELL_SIZE-2, Tank.CELL_SIZE-2 ) ;
    }
    cleanBulletCell(){
        ctx.fillStyle = `rgb(255,255,255)` ;
        ctx.fillRect( this.col*Tank.CELL_SIZE+1, this.row*Tank.CELL_SIZE+1, Tank.CELL_SIZE-2, Tank.CELL_SIZE-2 ) ;
    }
}
let tanks = [] ; 
for (let i=0;i<100;i++){
    tanks [tanks.length] = new Tank () ;
}
Tank.drawBackground () ;
let countDown = 3000 ;
let myTank = new MyTank() ;
run() ;
function run() {
    for (let i=0;i<tanks.length;i++){
        tanks [i].move() ;
    }
    myTank.cleanMyCell () ;
    myTank.drawMyCell () ;
    if ( --countDown > 0 ) {
        setTimeout( run, 40 ) ;
    }
}

    
</script>